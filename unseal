# unseal with key shards
root@ctudose:~# vault status
Key                Value
---                -----
Seal Type          shamir   >>> shamir - key shards
Initialized        true     >>> has been initialized
Sealed             true     >>> sealed with 3 keys
Total Shares       5
Threshold          3
Unseal Progress    0/3
Unseal Nonce       n/a
Version            1.18.3
Build Date         2024-12-16T14:00:53Z
Storage Type       file
HA Enabled         false

root@ctudose:~# cat /etc/vault.d/vault.hcl
storage "file" {
  path = "opt/vault/data"
}

listener "tcp" {
  address = "0.0.0.0:8200"
  tls_disable = 1
}

api_addr = "http://127.0.0.1:8200"
cluster_addr = "http://127.0.0.1:8201"

ui = true
disable_mlock = true

root@ctudose:~# vault operator unseal Y
Key                Value
---                -----
Seal Type          shamir
Initialized        true
Sealed             true
Total Shares       5
Threshold          3
Unseal Progress    2/3
Unseal Nonce       34b77f2b-dce0-dcb7-55a1-fbd496ca9e1b
Version            1.18.3
Build Date         2024-12-16T14:00:53Z
Storage Type       file
HA Enabled         false
root@ctudose:~# vault operator unseal u
Key             Value
---             -----
Seal Type       shamir
Initialized     true
Sealed          false   <<<<< unseal
Total Shares    5
Threshold       3
Version         1.18.3
Build Date      2024-12-16T14:00:53Z
Storage Type    file
Cluster Name    vault-cluster-08459538
Cluster ID      3b6c2a8b-d20f-0ca8-b53c-ade159be4a6a
HA Enabled      false

root@ctudose:~# vault login h
Success! You are now authenticated. The token information displayed below
is already stored in the token helper. You do NOT need to run "vault login"
again. Future Vault requests will automatically use this token.

Key                  Value
---                  -----
token                h
token_accessor       Y
token_duration       ∞
token_renewable      false
token_policies       ["root"]  >>> root token policy which never expires
identity_policies    []
policies             ["root"]

root@ctudose:~# vault secrets list
Path          Type         Accessor              Description
----          ----         --------              -----------
cubbyhole/    cubbyhole    cubbyhole_faaca29b    per-token private secret storage
identity/     identity     identity_42e59d53     identity store
secret/       kv           kv_7b18ca03           n/a
sys/          system       system_6d4bcaaa       system endpoints used for control, policy and debugging

#auto unseal
 - a basic /etc/vault.d/vault.hcl configuration file for integrating HashiCorp Vault with Azure Key Vault as a storage backend. It also includes settings for the storage listener, API address, cluster address, and cluster name.
Example vault.hcl:
storage "azure" {
  account_name      = "your-azure-storage-account-name"
  container        = "your-container-name"
  environment      = "AzurePublicCloud"
  max_parallel     = 128
}

listener "tcp" {
  address       = "0.0.0.0:8200"
  tls_disable   = 1  # Set to 0 if using TLS, then specify cert and key
}

api_addr = "http://your-vault-server-ip:8200"
cluster_addr = "http://your-vault-server-ip:8201"
cluster_name = "your-cluster-name"

ui = true

Storage: Configures Azure Key Vault as the backend using Azure Storage Account.
Listener: Binds Vault to all available interfaces on port 8200, with TLS disabled (enable TLS in production).
API Address: The address for Vault’s API.
Cluster Address: The address Vault uses for cluster communication.
Cluster Name: Defines the cluster’s name.
UI: Enables the Vault web interface.
